{% extends "default.html.twig" %}

{% block title %}Notification de {% endblock %}

{% block stylesheet %}
<link href="/../public/css/notification.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    crossorigin="anonymous" referrerpolicy="no-referrer" />
{% endblock %}

{% block header %}
{% include 'header.html.twig' %}
{% endblock %}

{% block body %}
<h1>test</h1>

<div class="notification-container">
    {% for notification in notifications %}
    <div class="notification {% if not notification.IsRead %}unread{% endif %}">
        <p>{{ notification.MessageNotif }}</p>
        <span>{{ notification.CreatedAt|date("d/m/Y H:i") }}</span>
    </div>
    {% endfor %}
</div>

<div id="scroll-target"></div>

{% endblock %}

{% block footer %}{% endblock %}

{% block scripts %}
<script src="/../public/js/ScrollDownMessage.js"></script>
<script>
    function loadMessages() {
        const xhr = new XMLHttpRequest();
        xhr.open('GET', window.location.href, true); // Rechargement de la même URL
        xhr.onload = function () {
            if (xhr.status >= 200 && xhr.status < 300) {
                const parser = new DOMParser();
                const doc = parser.parseFromString(xhr.responseText, 'text/html');
                const newNotifications = doc.querySelectorAll('.notification'); // Sélectionner toutes les nouvelles notifications
                const notificationContainer = document.querySelector('.notification-container'); // Container pour les notifications

                // Mise à jour des notifications
                notificationContainer.innerHTML = ''; // Vider l'ancien contenu
                newNotifications.forEach(notification => {
                    notificationContainer.appendChild(notification);
                });

                // Défilement vers le bas
                const scrollTarget = document.getElementById('scroll-target');
                scrollTarget.scrollIntoView({ behavior: 'smooth' });
            }
        };
        xhr.send();
    }

    // Charger les notifications toutes les secondes
    setInterval(loadMessages, 1000);
</script>

{% endblock %}
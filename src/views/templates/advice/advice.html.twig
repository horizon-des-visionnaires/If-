{% extends "default.html.twig" %}

{% block title %}IFÀ | conseil{% endblock %}

{% block stylesheet %}
<link href="/../public/css/advice.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    crossorigin="anonymous" referrerpolicy="no-referrer" />
{% endblock %}

{% block header %}
{# {% include 'header.html.twig' %} #}
{% endblock %}

{% block body %}
<div class="search-add">
    <div class="searchBar">
        <form action="/advice" method="get" class="search-form">
            <div class="group-search">
                {# <svg class="iconSearch" aria-hidden="true" viewBox="0 0 24 24">
                    <g>
                        <path
                            d="M21.53 20.47l-3.66-3.66C19.195 15.24 20 13.214 20 11c0-4.97-4.03-9-9-9s-9 4.03-9 9 4.03 9 9 9c2.215 0 4.24-.804 5.808-2.13l3.66 3.66c.147.146.34.22.53.22s.385-.073.53-.22c.295-.293.295-.767.002-1.06zM3.5 11c0-4.135 3.365-7.5 7.5-7.5s7.5 3.365 7.5 7.5-3.365 7.5-7.5 7.5-7.5-3.365-7.5-7.5z">
                        </path>
                    </g>
                </svg> #}
                <input placeholder="Cherchez un nom, un titre" type="search" value="{{ searchQuery }}" class="search"
                    name="search">
            </div>
        </form>
    </div>
</div>

{% if isConnected and isPro %}
<div class="profilButton">
    <button id="openModalButton" class="beautiful-button">ajouter un conseil</button>
</div>
{% endif %}

<div id="profileModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <form action="/advice" method="post" id="formAdvice" enctype="multipart/form-data">
            <input type="text" name="AdviceType" placeholder="Titre, Sujet, Thème" id="inputField" required>
            <div style="position: relative;">
                <textarea name="AdviceDescription" placeholder="Description du service" id="inputFieldDesc"
                    required></textarea>
            </div>
            <div class="availability-section">
                <label>Disponibilités:</label>
                <label for="dayOfWeek">Jours:</label>
                <div>
                    <label><input type="checkbox" name="DaysOfWeek[]" value="Monday"> Lundi</label>
                    <label><input type="checkbox" name="DaysOfWeek[]" value="Tuesday"> Mardi</label>
                    <label><input type="checkbox" name="DaysOfWeek[]" value="Wednesday"> Mercredi</label>
                    <label><input type="checkbox" name="DaysOfWeek[]" value="Thursday"> Jeudi</label>
                    <label><input type="checkbox" name="DaysOfWeek[]" value="Friday"> Vendredi</label>
                    <label><input type="checkbox" name="DaysOfWeek[]" value="Saturday"> Samedi</label>
                    <label><input type="checkbox" name="DaysOfWeek[]" value="Sunday"> Dimanche</label>
                </div>
                <label for="startTime">Heure de début:</label>
                <input type="time" name="StartTime" id="startTime" required>
                <label for="endTime">Heure de fin:</label>
                <input type="time" name="EndTime" id="endTime" required>
            </div>
            <button type="submit" name="addAdvice" id="inputField2">Soumettre le form</button>
        </form>
    </div>
</div>

<div class="adviceContainer">
    {% for Advice in adviceData %}
    <div class="advice">
        <a href="profile-{{ Advice.IdUser }}">
            <div class="profilPictureName">
                <img id="icon" src="data:image;base64,{{Advice.ProfilPicture}}" alt="icon">
                <h1>{{ Advice.FirstName }} {{ Advice.LastName }}</h1> <i id="certifIcon"
                    class="fas fa-check-circle"></i>
                <p>{{ Advice.ProfilPromotion }} </p>
            </div>
        </a>
        <div class="adviceData">
            <p>{{ Advice.AdviceType }} </p>
            <p>{{ Advice.AdviceDescription }} </p>
            <ul>
                <li>{{ Advice.DaysOfWeek }} de {{ Advice.StartTime }} à {{ Advice.EndTime }}</li>
            </ul>
            <p>prix = 10 €</p>
        </div>
        {% if isConnected %}
        <div class="BuyAdviceButton">
            <button data-modal-id="BuyAdviceModal-{{ Advice.IdAdvice }}" class="beautiful-button">acheter ce conseil</button>
        </div>
        {% endif %}
    </div>
    {% endfor %}
</div>

{% for Advice in adviceData %}
<div id="BuyAdviceModal-{{ Advice.IdAdvice }}" class="modal2">
    <div class="modal-content2">
        <span class="close2" data-modal-id="BuyAdviceModal-{{ Advice.IdAdvice }}">&times;</span>
        <form action="/advice" method="post" id="formAdvice-{{ Advice.IdAdvice }}" enctype="multipart/form-data">
            <label for="date">Date:</label>
            <input type="date" name="Date" id="date-{{ Advice.IdAdvice }}" required>

            <label for="startTime">Heure de début:</label>
            <input type="time" name="StartTime" id="startTime" required>
            <label for="endTime">Heure de fin:</label>
            <input type="time" name="EndTime" id="endTime" required>

            <input type="hidden" name="IdAdvice" value="{{ Advice.IdAdvice }}">

            <button type="submit" name="buyAdvice" id="inputField2">acheter le conseil</button>
        </form>
    </div>
</div>
{% endfor %}

{% endblock %}

{% block footer %}{% endblock %}

{% block scripts %}
<script src="/../public/js/modalUser.js"></script>
<script src="/../public/js/buyAdvice.js"></script>
<script>
    // Set the min attribute of the date input fields to today's date
    document.addEventListener('DOMContentLoaded', function () {
        const today = new Date().toISOString().split('T')[0];
        document.querySelectorAll('input[type="date"]').forEach(function(input) {
            input.setAttribute('min', today);
        });
    });
</script>
{% endblock %}